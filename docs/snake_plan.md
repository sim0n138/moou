# План разработки игры «Змейка»

## Общий обзор
Разработка настольной 2D-игры «Змейка» на Python с использованием Pygame.
Цель — создать кроссплатформенную версию для разработки и подготовить Windows-сборку `.exe`.

## Основные требования
- **Кадровая частота:** отрисовка фиксирована на 60 FPS, логика движения змейки управляется отдельным таймером.
- **Управление:** стрелки или WASD. Запрет разворота на 180° реализуется через буферизацию допустимых поворотов между тиками логики.
- **Игровое поле:** координаты определяются сеткой. Размеры окна рассчитываются на основе количества ячеек и размера клетки.
- **Рост и движение змейки:** управление списком сегментов. Очередь входных команд исключает мгновенные саморазвороты.
- **Генерация пищи:** используется детерминированный выбор из списка свободных клеток без бесконечных циклов.
- **Состояния игры:** простая конечная автоматная модель (`RUNNING`, `PAUSED`, `GAME_OVER`).
- **Счёт и рекорд:** запись рекорда в файлы в пользовательской директории (совместимо с PyInstaller).
- **Ускорение:** каждые `accel_every` очков интервал движения сокращается с нижним пределом.
- **Рендеринг:** минимизация перерисовки текста (кэш поверхностей), рисование через целочисленные прямоугольники; сетка включается опционально.
- **Звуки/ассеты:** хранение в `assets/`, доступ через вспомогательную функцию `resource_path` для совместимости с PyInstaller.

## Архитектура проекта
```
game/
├── __init__.py
├── config.py          # размеры сетки, интервалы логики, пути к ресурсам
├── resources.py       # helper resource_path и загрузка ассетов
├── state.py           # перечисление состояний игры
├── snake.py           # модель змейки и очередь поворотов
├── food.py            # выбор свободных клеток и генерация
├── score.py           # управление очками и рекордами
└── core.py            # основной игровой цикл, события, рендер

assets/
├── fonts/
└── sounds/

tests/
├── test_snake.py
├── test_food.py
└── test_score.py
```

## Этапы реализации
1. **Подготовка окружения**
   - Виртуальное окружение, установка зависимостей (`pygame`, `pytest`, `pyinstaller`, `ruff`).
   - Настройка `pyproject.toml` или `requirements.txt`.

2. **Базовая инфраструктура**
   - Создание модуля `config` с параметрами сетки, скоростями, путями.
   - Реализация вспомогательной функции `resource_path`.

3. **Игровая логика**
   - Класс `Snake` с очередью входа и проверкой допустимых поворотов.
   - Класс `FoodSpawner` с выбором случайной свободной клетки через `random.choice`.
   - Менеджер состояний игры.

4. **Игровой цикл и рендер**
   - Основной цикл с двумя таймерами: один для отрисовки (60 FPS), второй для шагов логики змейки.
   - Обновление и рендеринг UI, оптимизация отрисовки текста (кэширование поверхностей).
   - Реализация паузы (`P`) и рестарта (`R`).

5. **Очки и рекорд**
   - Хранение рекорда в файле, создаваемом в каталоге пользователя (`AppData`/`~/.local/share`).
   - Ведение текущего счёта и обновление поверхностей текста по событию изменения.

6. **Дополнительные возможности**
   - Опциональные звуковые эффекты и сетка фона.
   - Настраиваемое ускорение через конфиг.

7. **Тестирование**
   - Писать тесты для чистых модулей (`snake`, `food`, `score`).
   - Запуск `pytest` и линтера.

8. **Сборка и релиз**
   - Конфигурация PyInstaller (`pyinstaller --onefile --windowed game/core.py --name Snake`).
   - Добавление ассетов через `--add-data`.
   - Тестирование сборки на Windows и документирование в README.

## Документация
- Расширенный README с описанием управления, зависимостей и инструкциями по сборке.
- Замечания по производительности и настройке параметров в `config.py`.

## Оценка трудозатрат
- Объём — 1 неделя при частичной занятости.
- Основные риски: тестирование сборки на Windows и управление путями к ресурсам.

